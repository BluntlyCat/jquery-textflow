(function(u){var r=function(e,b){return b?e+Math.floor(Math.random()*(b-e)):Math.floor(Math.random()*e)},y=function(e){e=e?e:this.getDefaultDirections();this.x=e[r(e.length)].x;this.y=e[r(e.length)].y};y.prototype.directions={none:{x:0,y:0},north:{x:0,y:-1},northEast:{x:1,y:-1},east:{x:1,y:0},southEast:{x:1,y:1},south:{x:0,y:1},southWest:{x:-1,y:1},west:{x:-1,y:0},northWest:{x:-1,y:-1}};y.prototype.getDefaultDirections=function(){var e=[],b;for(b in self.directions)self.directions.hasOwnProperty(b)&&
e.push(self.directions[b]);return e};var D=function(e,b,l,p,c,h,g,m,n,d){var a=this,q=null,f=null,k=function(){a.rect={top:a.y-a.h,right:a.x+a.w,bottom:a.y,left:a.x}},v=function(){a.ax+=a.acceleration*g.x;Math.abs(a.ax)<Math.abs(a.maxAx)?q=setTimeout(v,40):a.ax=a.maxAx},C=function(){a.ax+=.1*g.x;Math.abs(a.ax)>Math.abs(a.maxAx)?f=setTimeout(C,40):(a.ax=a.maxAx,q=null)};this.x=b;this.y=l;this.maxAx=h;this.ay=this.ax=0;this.text=n;this.fontSize=d;this.font=d+"pt "+e.font;this.color=e.color;this.acceleration=
1/a.fontSize;this.w=p;this.h=c;this.vy=this.vx=0;this.rect=function(){return{top:a.y-a.fontSize,right:a.x+a.w,bottom:a.y-a.fontSize+a.h,left:a.x}};this.boostUp=function(d){a.ax+=d.fontSize/a.fontSize*(d.ax-a.ax);clearTimeout(f);clearTimeout(q);C()};this.breakDown=function(d){a.ax-=d.fontSize/a.fontSize*a.ax;clearTimeout(q);clearTimeout(f);v()};this.start=function(){v()};this.move=function(){a.vx=a.ax;a.vy=a.ay;a.x+=a.vx;a.y+=a.vy;k();0>g.x?0>a.rect.right&&m.removeElement(a):a.rect.left>m.width&&m.removeElement(a)};
k()},E=function(e,b,l,p,c,h,g,m,n,d){var a=this,q=null,f=800>=window.innerWidth?12:16,k=800>=window.innerWidth?16:20,v=function(){if(l.getElements().length<n){var c=r(f,k),h=d[r(d.length)],g,m=r(1,10)*b.x;p.txtCtx.font=c+"pt "+e.font;g=p.txtCtx.measureText(h).width;c=new D(e,0>b.x?a.width:-g,r(a.marginTop,a.height-a.marginBottom-a.marginTop-c),g,c,m,b,l,h,c);l.addElement(c);c.start()}q=setTimeout(v,r(1E3,2500))};this.width=c;this.height=h;this.marginTop=g;this.marginBottom=m;this.resize=function(d,
b,c,f){a.width=d;a.height=b;a.marginTop=c;a.marginBottom=f};this.start=function(){v()};this.stop=function(){clearTimeout(q)}},F=function(e,b,l,p,c,h,g){var m=this,n=u("<canvas></canvas>"),d=n[0].getContext("2d"),a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,q=window.cancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||
window.oCancelRequestAnimationFrame,f=null,k=function(){var b=l.getElements(),c,e;m.clear();for(c=0;c<b.length;c++)e=b[c],d.font=e.font,d.fillStyle=e.color,d.fillText(e.text,e.x,e.y);f=a(k)};this.resize=function(a,d){n.attr("width",b.width());n.attr("height",b.height());n.css({width:b.width()+"px",height:b.height()+"px",top:a?a+"px":0,left:d?d+"px":0})};this.txtCtx=d;this.clear=function(){var a=d.fillStyle;d.fillStyle="rgba(255, 0, 0, 1)";d.clearRect(0,0,b.outerWidth(),b.outerHeight());d.fillStyle=
a};this.size=function(){return{width:b.outerWidth(),height:b.outerHeight()}};this.start=function(){d.textAlign="start";k()};this.stop=function(){q(f);m.clear()};n.css({position:"absolute","z-index":2,background:"transparent"});b.css("background",e.background);n.appendTo(b);m.resize(p,c,h,g)},G=function(e,b,l){var p=this,c=null,h=[],g=[],m=function(d,a){var c=[d.x,d.x+d.width,a.x,a.x+a.width],b=[d.y,d.y+d.height,a.y,a.y+a.height],e=function(a,d){return a-d};c.sort(e);b.sort(e);return c[2]-c[1]>b[2]-
b[1]?"x":"y"},n=function(){for(var d=0;d<h.length;d++)h[d].move();for(d=0;d<g.length-1;d++)for(var a=g[d],b=d+1;b<g.length;b++){var f=g[b];if(!(a.rect.left>f.rect.right||f.rect.left>a.rect.right||a.rect.top>f.rect.bottom||f.rect.top>a.rect.bottom)&&"y"===m(a,f)){var k;0>e.x?(a.rect.left<f.rect.left?k=a:(k=f,f=a),k.boostUp(f),f.breakDown(k)):(a.rect.right>f.rect.right?(k=f,f=a):k=a,f.boostUp(k),k.breakDown(f))}}c=setTimeout(n,15)};this.width=b;this.height=l;this.addElement=function(d){h.push(d);g.push(d)};
this.removeElement=function(d){var a=[],b,c;for(b=0;b<h.length;b++)c=h[b],c!==d&&a.push(c);h=a;g=[];for(b=0;b<h.length;b++)c=h[b],g.push(c)};this.getElements=function(){return g};this.resize=function(b,a){p.width=b;p.height=a};this.start=function(){n()};this.stop=function(){clearTimeout(c)}},t=null,w=null,z=null,x=!1,A=function(){x||(t.start(),w.start(),z.start(),x=!0)},B=function(){x&&(t.stop(),w.stop(),z.stop(),x=!1)};u.fn.startTextFlow=function(){A()};u.fn.stopTextFlow=function(){B()};u.fn.textFlow=
function(e){var b=u(this),l=null,p=null,c=u.extend({width:"100%",height:"200px",top:0,left:0,maxTexts:15,marginTop:15,marginBottom:0,texts:["Add","your","own","texts","here"],color:"#000",background:"transparent",font:"sans-serif"},e);(function(){var e=[y.prototype.directions.east,y.prototype.directions.west];b.css({width:c.width,height:c.height,top:c.top,left:c.left,position:"relative"});if(!(c.texts instanceof Array))throw Error("Texts must be an array");p=c.texts;l=new y(e);w=new G(l,b.outerWidth(),
b.outerHeight());t=new F(c,b,w,c.width,c.height);z=new E(c,l,w,t,t.size().width,t.size().height,c.marginTop,c.marginBottom,c.maxTexts,p);b.startTextFlow()})();window.onresize=function(){b.css({width:c.width,height:c.height,top:c.top,left:c.left,position:"relative"});t.resize();w.resize(b.outerWidth(),b.outerHeight());z.resize(b.outerWidth(),b.outerHeight(),c.marginTop,c.marginBottom)};document.addEventListener("visibilitychange",function(){x?B():A()});document.addEventListener("keyup",function(b){27===
b.keyCode&&(x?B():A())})}})(jQuery);
